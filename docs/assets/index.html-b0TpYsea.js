import{_ as i,c as u,a,b as e,e as n,d as p,w as t,r as c,o as r}from"./app-BuzjU66J.js";const k={};function d(m,s){const l=c("LangVersion"),o=c("EnablePreviewFeatures");return r(),u("div",null,[s[6]||(s[6]=a(`<h1 id="csharp-10-0-新特性" tabindex="-1"><a class="header-anchor" href="#csharp-10-0-新特性"><span>CSharp 10.0 新特性</span></a></h1><h2 id="一、-安装必备" tabindex="-1"><a class="header-anchor" href="#一、-安装必备"><span>一、 安装必备</span></a></h2><p>下载最新 6 .NET SDK。 还可以下载 Visual Studio 2022，其中包括 .NET 6 SDK。</p><h2 id="二、新特性" tabindex="-1"><a class="header-anchor" href="#二、新特性"><span>二、新特性</span></a></h2><h3 id="_1-record-struct" tabindex="-1"><a class="header-anchor" href="#_1-record-struct"><span>1.record struct</span></a></h3><p>首先自然是 record struct，解决了 record 只能给 class 而不能给 struct 用的问题：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">record</span> <span class="token class-name"><span class="token keyword">struct</span></span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>用 record 定义 struct 的好处其实有很多，例如你无需重写 GetHashCode 和 Equals 之类的方法了。</p><p>sealed record ToString 方法 之前 record 的 ToString 是不能修饰为 sealed 的，因此如果你继承了一个 record，相应的 ToString 行为也会被改变，因此这是个虚方法。</p><p>但是现在你可以把 record 里的 ToString 方法标记成 sealed，这样你的 ToString 方法就不会被重写了。</p><h3 id="_2-struct-无参构造函数" tabindex="-1"><a class="header-anchor" href="#_2-struct-无参构造函数"><span>2.struct 无参构造函数</span></a></h3><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">struct</span> <span class="token class-name">Foo</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> X <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是使用的时候就要注意了，因为无参构造函数的存在使得 new struct() 和 default(struct) 的语义不一样了，例如 new Foo().X == default(Foo).X 在上面这个例子中将会得出 false。</p><h3 id="_3-匿名对象的-with" tabindex="-1"><a class="header-anchor" href="#_3-匿名对象的-with"><span>3.匿名对象的 with</span></a></h3><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> A <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> B <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> y <span class="token operator">=</span> x <span class="token keyword">with</span> <span class="token punctuation">{</span> A <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里 y.A 将会是 3 。</p><h3 id="_4-全局的-using" tabindex="-1"><a class="header-anchor" href="#_4-全局的-using"><span>4.全局的 using</span></a></h3><p>利用全局 using 可以给整个项目启用 usings，不再需要每个文件都写一份。比如你可以创建一个 Import.cs，然后里面写：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">global</span> <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">global</span> <span class="token keyword">using</span> <span class="token class-name">i32</span> <span class="token operator">=</span> <span class="token class-name">System<span class="token punctuation">.</span>Int32</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后你整个项目都无需再 using System，并且可以用 i32 了。</p><h3 id="_5-文件范围的-namespace" tabindex="-1"><a class="header-anchor" href="#_5-文件范围的-namespace"><span>5.文件范围的 namespace</span></a></h3><p>这个比较简单，以前写 namespace 还得带一层大括号，以后如果一个文件里只有一个 namespace 的话，那直接在最上面这样写就行了：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">namespace</span> <span class="token namespace">MyNamespace</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-常量字符串插值" tabindex="-1"><a class="header-anchor" href="#_6-常量字符串插值"><span>6.常量字符串插值</span></a></h3><p>你可以给 const string 使用字符串插值了，非常方便：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> x <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> y <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x</span><span class="token punctuation">}</span></span><span class="token string">, world!&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-lambda-改进" tabindex="-1"><a class="header-anchor" href="#_7-lambda-改进"><span>7.lambda 改进</span></a></h3><ol><li>支持 attributes lambda 可以带 attribute 了：</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Foo</span></span><span class="token punctuation">]</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">;</span> <span class="token comment">// 给 lambda 设置</span></span>
<span class="line">f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">return</span><span class="token punctuation">:</span> <span class="token class-name">Foo</span></span><span class="token punctuation">]</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">;</span> <span class="token comment">// 给 lambda 返回值设置</span></span>
<span class="line">f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Foo</span></span><span class="token punctuation">]</span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">;</span> <span class="token comment">// 给 lambda 参数设置</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>支持指定返回值类型 此前 C# 的 lambda 返回值类型靠推导，C# 10 开始允许在参数列表最前面显示指定 lambda 类型了：</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">f <span class="token operator">=</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>支持 ref 、in 、out 等修饰</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line">f <span class="token operator">=</span> <span class="token keyword">ref</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">ref</span> x<span class="token punctuation">;</span> <span class="token comment">// 返回一个参数的引用</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="4"><li>头等函数 函数可以隐式转换到 delegate，于是函数上升至头等函数：</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> Foo<span class="token punctuation">;</span></span>
<span class="line"><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>自然委托类型 lambda 现在会自动创建自然委托类型，于是不再需要写出类型了。</li></ol><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">var</span></span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Func&lt;int&gt;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> g <span class="token operator">=</span> <span class="token keyword">string</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">y</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span> <span class="token comment">// Func&lt;int, string, string&gt;</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">var</span></span> h <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">.</span>GetHashCode<span class="token punctuation">;</span> <span class="token comment">// Func&lt;int&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-callerargumentexpression" tabindex="-1"><a class="header-anchor" href="#_8-callerargumentexpression"><span>8.CallerArgumentExpression</span></a></h3><p>现在，CallerArgumentExpression 这个 attribute 终于有用了。借助这个 attribute，编译器会自动填充调用参数的表达式字符串，例如：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CallerArgumentExpression</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> expression <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>expression <span class="token operator">+</span> <span class="token string">&quot; = &quot;</span> <span class="token operator">+</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当你调用 Foo(4 + 5) 时，会输出 4 + 5 = 9。这对测试框架极其有用，因为你可以输出 assert 的原表达式了：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Assert</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CallerArgumentExpression</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> expr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AssertFailureException</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-tuple-支持混合定义和使用" tabindex="-1"><a class="header-anchor" href="#_9-tuple-支持混合定义和使用"><span>9.tuple 支持混合定义和使用</span></a></h3><p>比如：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">var</span></span> z<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>于是 y 就变成 2 了，同时还创建了两个变量 x 和 z，分别是 1 和 3 。</p><h3 id="_10-接口支持抽象静态方法" tabindex="-1"><a class="header-anchor" href="#_10-接口支持抽象静态方法"><span>10.接口支持抽象静态方法</span></a></h3>`,47)),e("p",null,[s[2]||(s[2]=n("这个特性将会在 .NET 6 作为 preview 特性放出，意味着默认是不启用的，需要设置",-1)),p(l,null,{default:t(()=>[...s[0]||(s[0]=[n("preview",-1)])]),_:1}),s[3]||(s[3]=n(" 和 ",-1)),p(o,null,{default:t(()=>[...s[1]||(s[1]=[n("true",-1)])]),_:1}),s[4]||(s[4]=n("，然后引入一个官方的 nuget 包 System.Runtime.Experimental 来启用。 然后接口就可以声明抽象静态成员了，.NET 的类型系统正式具备虚静态方法分发能力。 例如，你想定义一个可加而且有零的接口 ",-1)),s[5]||(s[5]=e("code",null,"IMonoid<T>",-1))]),s[7]||(s[7]=a(`<div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">IMonoid<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMonoid<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">abstract</span> <span class="token keyword">static</span> <span class="token return-type class-name">T</span> Zero <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">abstract</span> <span class="token keyword">static</span> T <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token class-name">T</span> l<span class="token punctuation">,</span> <span class="token class-name">T</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后可以对其进行实现，例如这里的 MyInt：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInt</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMonoid<span class="token punctuation">&lt;</span>MyInt<span class="token punctuation">&gt;</span></span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">MyInt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span> Value <span class="token operator">=</span> val<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">MyInt</span> Zero <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> MyInt <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token class-name">MyInt</span> l<span class="token punctuation">,</span> <span class="token class-name">MyInt</span> r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyInt</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>Value <span class="token operator">+</span> r<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后就能写出一个方法对 <code>IMoniod&lt;T&gt;</code> 进行求和了，这里为了方便写成扩展方法：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IMonoidExtensions</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Sum</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> t<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMonoid<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> T<span class="token punctuation">.</span>Zero<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> i <span class="token keyword">in</span> t<span class="token punctuation">)</span> result <span class="token operator">+=</span> i<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后调用：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token class-name">List<span class="token punctuation">&lt;</span>MyInt<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>你可能会问为什么要引入一个 <code>System.Runtime.Experimental</code>，因为这个包里面包含了 .NET 基础类型的改进：给所有的基础类型都实现了相应的接口，比如给数值类型都实现了 <code>INumber&lt;T&gt;</code>，给可以加的东西都实现了 <code>IAdditionOperators&lt;TLeft, TRight, TResult&gt;</code> 等等，用起来将会非常方便，比如你想写一个函数，这个函数用来把能相加的东西加起来：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> left<span class="token punctuation">,</span> <span class="token class-name">T</span> right<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAdditionOperators<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> T<span class="token punctuation">,</span> T<span class="token punctuation">&gt;</span></span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> left <span class="token operator">+</span> right<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就搞定了。</p><h3 id="_11-泛型-attribute" tabindex="-1"><a class="header-anchor" href="#_11-泛型-attribute"><span>11.泛型 attribute</span></a></h3><p>C# 的 attributes 支持泛型了，不过 .NET 6 中将以预览特定放出，因此需要 <code>&lt;LangVersion&gt;preview&lt;/LangVersion&gt;</code></p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">class</span> <span class="token class-name">TestAttribute<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> Data <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token function">TestAttribute</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span> Data <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后你就能这么用了：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token punctuation">[</span><span class="token generic-method"><span class="token function">Test</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token generic-method"><span class="token function">Test</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">float</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">4.5f</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token generic-method"><span class="token function">Test</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-允许在方法上指定-asyncmethodbuilder" tabindex="-1"><a class="header-anchor" href="#_12-允许在方法上指定-asyncmethodbuilder"><span>12.允许在方法上指定 AsyncMethodBuilder</span></a></h3><p>C# 10 将允许方法上使用 <code>[AsyncMethodBuilder(...)]</code> 来使用你自己实现的 async method builder，代替自带的 Task 或者 ValueTask 的异步方法构造器。这也有助于你自己实现零开销的异步方法。</p><h3 id="_13-嵌套属性模式匹配改进" tabindex="-1"><a class="header-anchor" href="#_13-嵌套属性模式匹配改进"><span>13.嵌套属性模式匹配改进</span></a></h3><p>以前在匹配嵌套属性的时候需要这么写：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token keyword">is</span> <span class="token punctuation">{</span> X<span class="token punctuation">:</span> <span class="token punctuation">{</span> Y<span class="token punctuation">:</span> <span class="token punctuation">{</span> Z<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现在只需要简单的：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token keyword">is</span> <span class="token punctuation">{</span> X<span class="token punctuation">.</span>Y<span class="token punctuation">.</span>Z<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>就可以了。</p><h1 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接"><span>参考链接</span></a></h1><ul><li><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/whats-new/csharp-10" target="_blank" rel="noopener noreferrer">C# 10 中的新增功能</a></li></ul>`,25))])}const h=i(k,[["render",d]]),g=JSON.parse('{"path":"/code/dotnet/CSharpNewFeatures/10.0/","title":"CSharp 10.0 新特性","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"Z小染","username":"","email":"ryning@sina.com","commits":1}],"changelog":[{"hash":"bf1e4a815939784d24a092c889c755dfe66da665","time":1668074552000,"email":"ryning@sina.com","author":"Z小染","message":"Add C# New Fratures"}]},"filePathRelative":"code/dotnet/CSharpNewFeatures/10.0/index.md"}');export{h as comp,g as data};
