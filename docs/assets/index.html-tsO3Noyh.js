import{_ as s,c as a,a as e,o as t}from"./app-BuzjU66J.js";const p={};function c(o,n){return t(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="httpcontext-items-vs-httpcontext-features" tabindex="-1"><a class="header-anchor" href="#httpcontext-items-vs-httpcontext-features"><span>HttpContext.Items vs HttpContext.Features</span></a></h1><h2 id="httpcontext-items" tabindex="-1"><a class="header-anchor" href="#httpcontext-items"><span>HttpContext.Items</span></a></h2><ul><li><code>​HttpContext.Items​​</code>​ 是设计用来存储键-值对的, 存储在当前请求上下文中共享的数据</li><li><code>HttpContext.Items</code> 是设计用来存储在单个请求中短期存在的数据</li></ul><h2 id="httpcontext-features" tabindex="-1"><a class="header-anchor" href="#httpcontext-features"><span>HttpContext.Features</span></a></h2><p>​<code>​HttpContext.Features</code>​​​ 是设计用来存储类型-实例 ​ 对的, 它是一个 <code>​​IFeatureCollection​</code>​ 的实例，该实例表示一组 HTTP 特性的集合</p><ul><li><code>IAuthenticationFeature</code> 存储原始的 PathBase 和 原始的 Path</li><li><code>ISessionFeature</code> 存储当前的 Session</li><li><code>IHttpConnectionFeature</code> 存储了当前的底层连接</li></ul><p>为了便于存储和提取 ​​ 类型-实例 ​​ 对，IFeatureCollection 接口定义了如下 3 个重要方法：</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IFeatureCollection</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>KeyValuePair<span class="token punctuation">&lt;</span>Type<span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token class-name">Type</span> key<span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token return-type class-name">TFeature</span> <span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Set</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">TFeature</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>IFeatureCollection</code> 的实现类 <code>FeatureCollection</code> 中，将获取的值简单地转型为要求的类型</p><div class="language-csharp line-numbers-mode" data-highlighter="prismjs" data-ext="cs"><pre><code class="language-csharp"><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeatureCollection</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IFeatureCollection</span></span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name">TFeature</span> <span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>TFeature<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TFeature</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Set</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">TFeature</span> instance<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TFeature</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> instance<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>在当前请求中不需要存储 2 个 <code>​​IHttpConnectionFeature​​</code>​ 实例，或者 2 个 ​<code>​ISession​​ </code>，尽管从技术上来说，你可以使用 <code>FeatureColliection</code> 来存储其它的类型-值对，但最好不要这样做，<code>​​Set&lt;TFeature&gt;(TFeature instance)​​ </code>方法在类型已经存储集合中的时候，会简单地替换掉原来的实例，这就意味着如果你希望存储同一类型的两个实例，是做不到的。</p></blockquote><p><code>HttpContext.Features</code> 是设计用来共享不同的 HTTP 特性的，这使得中间件可以创建或者修改应用程序的主机处理管线。通过 .NET 本身已经创建了一系列的特性，例如 <code>IHttpSendFileFeature</code>。</p><h2 id="结论" tabindex="-1"><a class="header-anchor" href="#结论"><span>结论</span></a></h2><p>应该只使用 <code>HttpContext.Items</code> 来存储数据，使用 <code>HttpContext.Features</code> 来添加新的其它中间件可能会使用的 HTTP 特性。</p>`,14)])])}const i=s(p,[["render",c]]),u=JSON.parse('{"path":"/code/dotnet/HttpContext/","title":"HttpContext.Items vs HttpContext.Features","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"Z小染","username":"","email":"ryning@sina.com","commits":2},{"name":"奶油拌云朵","username":"","email":"ryning@sina.com","commits":1}],"changelog":[{"hash":"7a6707b0a878e0a045555fb731a3c1d7589dacfd","time":1668602449000,"email":"ryning@sina.com","author":"奶油拌云朵","message":"update"},{"hash":"c8b3c358a18f9d39cc98a77c727e48dca755259f","time":1667375084000,"email":"ryning@sina.com","author":"Z小染","message":"build"},{"hash":"995f6bbc4321146d3e553a3bd6419e75fc085035","time":1666772012000,"email":"ryning@sina.com","author":"Z小染","message":"add file"}]},"filePathRelative":"code/dotnet/HttpContext/index.md"}');export{i as comp,u as data};
